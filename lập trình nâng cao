#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<Windows.h>
struct book_st
{
	char TacGia[30];
	char TenSach[30];
	char theloai[30];
	int giatien;
	int STT;
}; 
void set_color (int );
typedef struct book_st bookList;
void set_color ( int code ) {
    HANDLE color = GetStdHandle(STD_OUTPUT_HANDLE);
    SetConsoleTextAttribute( color , code );
}
void Nhap(bookList &a)
{
	printf("\nNhap ten sach: ");
	fflush(stdin);
	gets(a.TenSach);
	printf("Nhap ten tac gia: ");
	fflush(stdin);
	gets(a.TacGia);
	printf("Nhap the loai: ");
	fflush(stdin);
	gets(a.theloai);
	printf("Nhap gia tien: ");
	scanf("%d",&a.giatien);
}
void Nhap_(bookList *&a, int &n)
{	
    if(n==0)
	{
	 	a=(bookList*)malloc(sizeof(bookList));
	} 
	else
	{
	   realloc(a,(n+1)*sizeof(bookList));	
	}  
	printf("\nNhap cuon sach thu %d",n+1);
	Nhap(a[n]);
	a[n].STT=n+1;
	n++;	
}
void SapXep(bookList *a, int n)
{
	for(int i=0; i<n-1;i++)
	{
		for(int j=i+1;j<n;j++)
		{
			if(strcmp(a[i].theloai,a[j].theloai)<0)
			{
				bookList dem= a[i];
				a[i] = a[j];
				a[j] = dem;
			}
		}
	}
}
void ThongKe(bookList *a, int n)
{
	SapXep(a,n);
	int kt=0;
	for(int i= kt; i<n; i= kt)
	{
		int dem = 1;
		for(int j = kt+1; j<n; j++)
		{
			if(strcmp(a[i].theloai,a[j].theloai)== 0)
			{
				dem++;
			}
			else
			{
				break;
			}
		}
		if(dem>0)
		{
		   printf("\nThe loai %s co %d quyen",a[kt].theloai,dem);
		   kt =kt + dem;	
		}
	}
	
}
void inhang(int n)
{
	printf("\n");
	for(int i=1; i<=n; i++)
	{
		printf("=");
	}
}
void Xuat(bookList a, int i)
{
	inhang(100);
	printf("\n00%d",i+1);
	printf("||%-15s",a.TenSach);
	printf("||%-20s",a.TacGia);
	printf("||%-15s",a.theloai);
	printf("||%d",a.giatien);
}
void Xuat_(bookList *a, int n)
{
	ThongKe(a,n);
	printf("\n%s||%-20s%-25s%-20s%s","STT","Ten Sach","Ten Tac Gia","The Loai","Gia Tien");
	for(int i=0; i<n; i++)
	{
		Xuat(a[i],i);
	}
}
void TimKiem(bookList *a, int n)
{
	char ten[30];
	int kt=1;
	printf("\nNhap The Loai Sach Can Tim: ");
	fflush(stdin);
	gets(ten);
	printf("\n%s||%-20s%-25s%-20s%s","STT","Ten Sach","Ten Tac Gia","The Loai","Gia Tien");
	for(int i= 0; i<n; i++)
	{
		if(strcmp(a[i].theloai,ten)==0)
		{
				Xuat(a[i],i);
				kt=0;
		}
	}
	if(kt)
	{
		printf("\nKhong co quyen sach thuoc the loai %s trong du lieu",ten);
	}
}
void Xoa(bookList *&a, int &n)
{
	int stt;
	Xuat_(a,n);
    do
	{
		printf("\nNhap so thu tu cua quyen sach can xoa: ");
		scanf("%d",&stt);
		if(stt <1 || stt > n)
		{
			printf("\nVi tri xoa can nam trong doan thu tu [1;%d]",n);
		}
	}while(stt <1 || stt > n);
	stt--;
    for(int i= stt+1; i<n; i++)
	{
		   a[i-1]=a[i];
	}
     n--;
	realloc(a,n*sizeof(bookList));
}
void Them(bookList *&a, int &n)
{
	int stt;
	bookList b ;
	Xuat_(a,n);
	do
	{
		printf("\nNhap so thu tu cua quyen sach can them: ");
		scanf("%d",&stt);
		if(stt < 1 || stt > n+1)
		{
			printf("\nVi tri them can nam trong doan thu tu [1;%d]",n+1);
		}
	}while(stt<1 || stt >n+1);
	stt--;
	printf("\nNhap thong tin quyen sach can them:");
	Nhap(b);
	realloc(a,(n+1)*sizeof(bookList));
	for(int i=n-1; i>= stt; i--)
	{
		a[i+1] = a[i];
	}
    a[stt]=b;
	n++;
}
void CapNhat(bookList *&a, int n)
{
	int stt;
	do
	{
		printf("\nNhap so thu tu cua quyen sach can cap nhat: ");
		scanf("%d",&stt);
		if(stt <1 || stt > n)
		{
			printf("\nVi tri cap nhat can nam trong doan thu tu [1;%d]",n);
		}
	}while(stt <1 || stt > n);
	stt--;
	for(int i=0; i<n; i++)
	{
		if(stt==i)
		{
			Nhap(a[i]);
			return;
		}
	}
}
void GhiTiep(bookList *a, int n)
{
	FILE *cfPtr;
	cfPtr = fopen("book.dat","wb");
	rewind(cfPtr);
	for(int i=0; i<n ; i++)
	{
		fwrite(&a[i],sizeof(bookList),1,cfPtr);
	}
	fclose(cfPtr);
}
int EnterChoice(void);
void Menu();
int main()
{
	Menu();
}
int EnterChoice(void)
{
	int choice;
	system("cls");
	set_color( 0 << 10 | 0 << 4 | 7);
    system("CLS");
    set_color( 3 << 10 | 1 << 4 | 11);
    printf("                                                             #             \n  "); 
    printf("        #                          ##                    #  ##           \n "); 
    printf("          #                       #  #                   #      #         \n ");
	printf("            #                    #    #                       #           \n ") ;
    printf(" #####   #     ##     ########     #    ####      #         ##    #      #\n");
    printf("  #   #  # #    ##        ##      # #   #   #      #      #    #   # #    #\n");
    printf("  ###   #####   ##        ##     #####  # ##       #     #      #  #  #   #\n");
    printf("  #   # #   #   ##        ##     #   #  #          #      #    #   #   #  #\n");
    printf("  ####  #   #   ##        ##     #   #  #          #####    ##     #    # #\n");
    printf("                                   #                                       \n");
    set_color (10);
	printf("%s","\n\t\t\t\t\t\t======MENU======\n"
	"\t\t\t1 - Nhap du lieu cua tung quyen sach\n"
	"\t\t\t2 - Sap xep, thong ke va hien thi thong tin\n" 
	"\t\t\t    chi tiet cua tung quyen sach theo the loai (Z->A)\n"
	"\t\t\t3 - Tim quyen sach theo the loai\n"
	"\t\t\t4 - Ghi vao tap tin nhi phan book.dat\n"
	"\t\t\t5 - Them du lieu cua tung quyen sach\n"
	"\t\t\t6 - Xoa du lieu cua tung quyen sach\n"
	"\t\t\t7 - Cap nhat du lieu cua tung quyen sach\n"
	"\t\t\t8 - Thoat\n"
	"\t\t\tNhap lua chon cua ban: ");
	scanf("%d",&choice);
	return choice;
	
}
void Menu()
{
	bookList *a;
	int Choice,n=0;
	while((Choice = EnterChoice()) !=8)
	{
		switch(Choice)
		{
			case 1:
				Nhap_(a,n);
				break;
			case 2:
				if(n==0)
				{
					printf("\nBan chua nhap du lieu");
				}
				else
				{
					Xuat_(a,n);
				}
				system("pause");
				break;
			case 3:
				if(n==0)
				{
					printf("\nBan chua nhap du lieu");
				}
				else
				{
					TimKiem(a,n);
				}
				system("pause");
				break;
			case 4:
				if(n==0)
				{
					printf("\nBan chua nhap du lieu");
				}
				else
				{
					GhiTiep(a,n);
				}
				system("pause");
				break;
			case 5:
			    if(n==0)
				{
					printf("\nBan chua nhap du lieu");
				}
				else
				{
					Them(a,n);
				}
				system("pause");
			    break;
			case 6:
				if(n==0)
				{
					printf("\nBan chua nhap du lieu");
				}
				else
				{
					Xoa(a,n);
				}
				system("pause");
				break;
			case 7:
				if(n==0)
				{
					printf("\nBan chua nhap du lieu");
				}
				else
				{
					CapNhat(a,n);
				}
				system("pause");
				break;
			case 8:
				break; 
			default:
				printf("\nLua chon khong hop le !");
				system("pause");
				break;	
		}
	}
	free(a);
}

